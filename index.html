<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
		<style type="text/css">
			a {
				color:	#4060A0;
			}

			a:hover {
				color:	#728FC7;
			}

			aside.toc {
				position:	fixed;
				top:		32px;
				right:		64px;
				text-align:	right;
				max-width:	200px;
			}

			aside.toc a {
				text-decoration:	none;
			}

			aside.toc a:hover {
				text-decoration:	underline;
			}

			aside.toc strong {
				color:	#4060A0;
			}

			aside.toc ul {
				padding:		0;
				margin:			0;
				font-size:		0.9em;
				line-height:	1.2;
				list-style:		none;
			}

			aside.toc ul li {
				margin:	6px 0;
			}

			aside.toc ul li a,
			aside.toc ul li ul li a {
				display:		block;
				padding-right:	6px;
				border-right:	0px;
			}

			aside.toc ul li ul {
				display:		none;
				padding-right:	8px;
				font-size:		0.8em;
			}

			aside.toc ul li ul li {
				margin:	4px 0;
			}

			aside.toc ul li:hover > a {
				padding-right:	5px;
				border-right:	1px solid #4060A0;
			}

			aside.toc ul li.active > a {
				padding-right:	4px;
				border-right:	2px solid #4060A0;
				color:			#728FC7;
			}

			aside.toc ul li:hover > ul,
			aside.toc ul li.active > ul {
				display:	block;
			}

			body {
				padding:		0px;
				margin:			32px 64px 32px 64px;
				font:			normal normal normal 0.9em "Helvetica Neue", Helvetica, Arial, sans-serif;
				line-height:	1.4;
				color:			#303030;
			}

			body aside.toc {
				display:	none;
			}

			body.toc {
				margin-right:	264px;
			}

			body.toc aside.toc {
				display:	block;
			}

			blockquote.code {
				position:		relative;
				padding:		4px 8px;
				margin:			16px 0;
				background:		#E3EDF6;
				border-top:		1px solid #A9C7E4;
				border-right:	1px solid #BDD3EA;
				border-bottom:	1px solid #BDD3EA;
				border-left:	1px solid #A9C7E4;
				border-radius:	4px;
				color:			#4060A0;
			}

			blockquote.code code {
				display:		block;
				font:			normal normal normal 0.8em Menlo, Monaco, Consolas, "Courier New", monospace;
				white-space:	pre-wrap;
			}

			blockquote.code code strong {
				font-weight:	bold;
				color:			#2A3F69;
			}

			blockquote.code span {
				float:			right;
				position:		relative;
				top:			-10px;
				padding:		1px 8px;
				background:		#BDD3EA;
				border-top:		1px solid #A9C7E4;
				border-right:	1px solid #96BADD;
				border-bottom:	1px solid #96BADD;
				border-left:	1px solid #A9C7E4;
				border-radius:	8px;
				font-size:		0.8em;
				font-weight:	bold;
			}

			div.section {
				margin:	8px 0 48px 0;
			}

			div.section div.section {
				margin:		8px 0 32px 0;
			}

			div.section div.section div.section {
				margin:		8px 0 24px 0;
			}

			div.section div.section div.section div.section {
				margin:		8px 0 16px 0;
			}

			div.section li code,
			div.section p code {
				padding:		0 2px;
				font:			normal normal normal 1.0em monospace;
				background:		#E3EDF6;
				border-top:		1px solid #A9C7E4;
				border-right:	1px solid #BDD3EA;
				border-bottom:	1px solid #BDD3EA;
				border-left:	1px solid #A9C7E4;
				border-radius:	4px;
				color:			#2A3F69;
			}			

			div.section p {
				margin:	12px 0;
			}

			div.section ul {
				padding:	4px 32px;
				margin:		8px 0px;
				list-style:	circle;
			}

			div.section ul ul {
				padding:	0px 32px;
				margin:		0px;
			}

			h1 {
				padding:		0px;
				margin:			32px 8px;
				text-align:		center;				
				font-size:		2.2em;
				font-variant:	small-caps;
				color:			#4060A0;
			}

			h2 {
				padding:	0px;
				margin:		24px 16px;
				font-size:	1.4em;
				color:		#5070B0;
			}

			h3 {
				padding:	0px;
				margin:		16px 24px;
				font-size:	1.2em;
				color:		#6080C0;
			}

			h4 {
				padding:	0px;
				margin:		4px 0;
				font-size:	1.0em;
				color:		#728FC7;
			}
		</style>
		<title>Cottle Documentation</title>
	</head>
	<body>
		<h1>Cottle Documentation</h1>
		<aside class="toc">
			<strong>Table of contents</strong>
			<ul id="toc-to"></ul>
		</aside>
		<div class="section" id="toc-from">
			<h2>Library overview</h2>
			<div class="section">
				<h3>What does it looks like?</h3>
				<div class="section">
					<p>Cottle, short for "<strong>C</strong>ompact
					<strong>O</strong>bject to <strong>T</strong>ext
					<strong>T</strong>ransform
					<strong>L</strong>anguag<strong>e</strong>" is a
					lightweight template engine for .NET 3.5 allowing you to
					transform structured data into any text-based format output
					such as plain text, HTML or XML. It uses a simple yet
					easily extensible template language, thus enabling clean
					separation of document contents and layout.</p>
					<p>A simple Cottle template printing an HTML document
					showing how many messages are in your mailbox could look
					like this:</p>
					<blockquote class="code">
						<span>Template</span>
<code>&lt;html&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello, {name}!&lt;/h1&gt;
        &lt;p&gt;
            {if len(messages) &gt; 0:
                You have {len(messages)} new message{if len(messages) &gt; 1:s} in your mailbox!
            |else:
                You have no new message.
            }
        &lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code>
					</blockquote>
					<p>As you can guess by looking at this code, a Cottle
					template contains both "raw" text printed directly and
					commands used to define dynamic sections. Cottle supports
					most common template engine features, including:</p>
					<ul>
						<li>Text substitutions through variables,</li>
						<li>Builtin and used-defined functions,</li>
						<li>Variables & functions declaration and
						assignments,</li>
						<li>Conditional statements (if),</li>
						<li>Loops (for, while).</li>
					</ul>
					<p>Source code is available, feel free to read and
					contribute!</p>
				</div>

				<h3>Download the library</h3>
				<div class="section">
					<p>Cottle is available as an installable package on
					<a href="http://www.nuget.org/packages/Cottle/">NuGet</a>
					official website. Just open your extension manager in
					Visual Studio, search for "Cottle" and install from
					there.</p>
					<p>You can also read, download or contribute to the source
					code on
					<a href="https://github.com/r3c/cottle">GitHub</a>.</p>
				</div>

				<h3 id="getting_started">Getting started</h3>
				<div class="section">
					<p>To start using Cottle, first reference the package in
					your solution (using NuGet or manual install). You'll then
					need two things:</p>
					<ul>
						<li>An input template written with Cottle's template
						language, used to control how your data must be
						rendered. This template can be contained in a
						<code>string</code> or streamed from any source
						compatible with <code>System.IO.TextReader</code> class
						(text file, memory buffer, network socket...) as shown
						in the example below.</li>
						<li>An executable code that reads your input template,
						create a <code>Cottle.IDocument</code> object from it
						then render it to an output string or
						<code>System.IO.TextWriter</code> instance.</li>
					</ul>
					<p>Here is a basic yet working sample rendering a plain
					text template that doesn't contain dynamic code. Copy the
					"<strong>Template</strong>" snippet in a "test.cottle" file
					you put in the same folder your project executable is, then
					copy the "<strong>C# code</strong>" snippet somewhere in
					your program and get it executed. You should see the
					content of "<strong>Result</strong>" snippet printed to
					standard output:</p>
					<blockquote class="code">
						<span>Template</span>
<code>This is my input template file (with only literal text for now).</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>void RenderAndPrintMyTemplate()
{
    IDocument document;
    IStore store;

    using (var stream = new FileStream("test.cottle", FileMode.Open))
    {
        using (var reader = new StreamReader(stream, Encoding.UTF8))
        {
            document = new SimpleDocument(reader); // throws ParseException on error
        }
    }

    store = new BuiltinStore(); // this is where variables can be stored
    store["somevar"] = "some value"; // declare new "somevar" string variable

    <strong>/* TODO: customize rendering if needed */</strong>

    Console.Write(document.Render(store));
}</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>This is my input template file (with only literal text for now).</code>
					</blockquote>
					<p>Next samples in this document will show the same
					"Template", "C# code" and "Result" snippets. Since the C#
					code above applies to all following examples it won't be
					repeated and only parts that should replace the
					"<strong>TODO</strong>" comment will appear.
					</p>
				</div>
			</div>

			<h2>Template language</h2>
			<div class="section">
				<h3>Literal text and commands</h3>
				<div class="section">
					<p>A Cottle template can contain literal text (which will
					be printed "as is") and special command that will be
					executed when document is rendered. These commands can
					either print dynamic content or have side-effects such as
					controlling rendering flow or store variables. Here is an
					example using the "echo" command to print content of a
					variable named "x", we'll assume its value is "53":</p>
					<blockquote class="code">
						<span>Template</span>
						<code>Value of x is {echo x}.</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
						<code>Value of x is 53.</code>
					</blockquote>
					<p>Here we used the <code>echo</code> command which prints
					the value of its argument to display current value of
					variable <code>x</code>. We'll see in next section how to
					pass variables to templates. Command <code>echo</code> is
					the most commonly used command so a shorter form is
					available and you can omit the "echo" keyword if the name
					of the variable you want to print doesn't conflict with
					another command: <code>{echo 53}</code> is equivalent to
					<code>{53}</code> in previous example. This form will be
					used in all following samples.</p>
					<p>All commands should appear between special "begin
					command" and "end command" delimiters "{" (left brace) and
					"}" (right brace). Contents between those delimiters is
					recognized as commands which have their own syntax.
					Character "|" (pipe) is also used as a "continue command"
					delimiter for some commands.</p>
					<p>Since delimiters have a special meaning you must escape
					them if you want to use them as literal text. Use a
					backslash character before any deliminer (or another
					backslash) to escape it:</p>
					<blockquote class="code">
						<span>Template</span>
						<code>Characters \{, \}, \| and \\ must be escaped.</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
						<code>Characters {, }, | and \ must be escaped.</code>
					</blockquote>
					<p>Delimiters can be changed as you'll see in section
					"<a href="#delimiters_customization">delimiters customization</a>".</p>
				</div>

				<h3>Sending variables to templates</h3>
				<div class="section">
					<p>To send variables so they can be used when a document
					is rendered you must store them in a
					<code>Cottle.IStore</code> instance which is used as a
					render-time storage. This interface behaves quite like a
					<code>Dictionary&lt;Cottle.Value, Cottle.Value&gt;</code>
					where <code>Cottle.Value</code> is a data structure able to
					store any value Cottle can handle. Key and value pairs
					within this dictionary are used as variable names and their
					associated values.</p>
					<p>Implicit constructors from some native .NET types to
					<code>Value</code> type are provided so you usually don't
					have to explicitly do the conversion yourself but you can
					browse <code>Cottle.Values</code> namespace to see
					available types.</p>
					<p>Once you assigned variables to a store, pass it to your
					document's rendering method so you can read them from your
					template (see "<a href="#getting_started">getting
					started</a>" section for full code):</p>
					<blockquote class="code">
						<span>Template</span>
<code>Hello {echo name}, you have no new message.</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>store["name"] = "John"; // implicit conversion, equivalent to 'new StringValue("John")'</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>Hello John, you have no new message.</code>
					</blockquote>
					<p>Stores are passed at document render time so they can be
					changed from one render to another. This allows you to
					reuse a compiled document multiple times, since compiling a
					document has an important cost compared to rendering.</p>
				</div>

				<h3>Constants, variables and types</h3>
				<div class="section">
					<p>Cottle supports immutable values which can either be
					declared as constants in templates or stored in stores you
					pass when rendering a document. Values have a type which
					can be one of the following:</p>
					<ul>
						<li>Boolean (value is either true or false) ;</li>
						<li>Number (equivalent to .NET's decimal) ;</li>
						<li>String (sequence of character) ;</li>
						<li>Map (associative key/value container) ;</li>
						<li>Void (value is undefined)</li>
					</ul>
					<p>Map values are associative tables that contain multiple
					children values stored as key/value pairs. Values within a
					map can be accessed directly by their key, using either
					dotted or subscript notation:</p>
					<blockquote class="code">
						<span>Template</span>
<code>You can use either {mymap.f1} or {mymap["f2"]} notations for map values.</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>store["mymap"] = new Dictionary&lt;Value, Value&gt; // implicit conversion to MapValue
{
    {"f1", "dotted"},
    {"f2", "subscript"}
};</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>You can use either dotted or subscript notations for map values.</code>
					</blockquote>
					<p>Please note the quotes used in subscript notation.
					Trying to access value of <code>{mymap[f2]}</code> will
					result in a very different behavior, since it will search
					for the value whose key is the value of <code>f2</code>
					(which hasn't be defined), leading to an undefined (void)
					result. It is valid to have a map in which two or more keys
					are equal, but you will only be able to access the last
					one when using direct access. However, iteration through
					the map's elements, as we'll see later, will show you
					its entire content.</p>
					<p>Implicit constructors on <code>Cottle.Value</code> class
					allow you to convert most .NET standard types into a Cottle
					value instance. To get an undefined value your from C# code
					use the <code>Cottle.Values.VoidValue.Instance</code>
					static property.</p>
					<p>You can also declare constant values in your templates
					with following constructs:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{echo 17.42}
{echo "Constant string"}
{echo 'String with single quotes'}
{echo ["key1": "value1", "key2": "value2"]}
{echo ["constant", "map", "with", "numeric", "keys"]}</code>
					</blockquote>
					<p>Keys can be ommited in constant maps declaration,
					numeric keys starting at index 0 are generated in this
					case. Also remember that both keys and values can be of any
					value type (numbers, strings, other nested maps...). There
					is no way to write a constant boolean value in a
					template ; you can write your own
					<a href="#custom_dotnet_methods">functions</a> if you
					really need this feature, but numeric values 0 and 1
					are equivalent except in very special cases.</p>
				</div>

				<h3>Expression operators</h3>
				<div class="section">
					<p>Cottle supports the same mathematical and logical
					operators found in most programming langages. Here they
					are sorted by decreasing precedence order:</p>
					<ul>
						<li><code>+</code>, <code>-</code> and <code>!</code>:
						unary plus, minus and logical "not" operator ;</li>
						<li><code>*</code>, <code>/</code> and <code>%</code>:
						binary multiplication, division and modulo operators ;
						</li>
						<li><code>+</code> and <code>-</code>: binary addition
						and subtraction operators ;</li>
						<li><code>&lt;</code>, <code>&lt;=</code>,
						<code>=</code>, <code>!=</code>, <code>&gt;=</code> and
						<code>&gt;</code>: binary logical comparison operators
						;</li>
						<li><code>&amp;&amp;</code> and <code>||</code>:
						binary "and" and "or" logical operators.</li>
					</ul>
					<p>You can also use <code>(</code> and <code>)</code> to
					group sub-expressions and change natural precedence
					order. Here are some example of valid expressions:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{1 + 2 * 3}
{(1 + 2) * 3}
{!(x &lt; 1 || x &gt; 9)}
{value / 2 &gt;= -10}
{"aaa" &lt; "aab"}</code>
					</blockquote>
					<p>Mathematical operators (<code>+</code>, <code>-</code>,
					<code>*</code>, <code>/</code> and <code>%</code>) only
					accept numeric operands and return a numeric value (or a
					void value in case of division by zero). Logical operators
					work on any type of operand in a similar way the
					<a href="#function_cmp">cmp</a> standard function
					does.</code>
				</div>

				<h3>Calling builtin functions</h3>
				<div class="section">
					<p>Functions in Cottle are special values that can be
					invoked like in most programming languages. As they are
					values, they are stored in a store, and a special store
					class is available so you can start with a predefined set
					of standard functions when rendering your documents. To use
					them, create a <code>BuiltinStore</code> instance and pass
					it to document's rendering method.</p>
					<p>If you don't want to use standard functions you can use
					a blank store (e.g. an instance of <code>SimpleStore</code>
					class, or your own implementation of the
					<code>IStore</code> interface).</p>
					<p>Here is how to call a function:</p>
					<blockquote class="code">
						<span>Template</span>
<code>You have {len(messages)} new message(s) in your inbox.</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>IStore store;

store = new BuiltinStore(); // must be used to have the "len" function available

store["messages"] = new Dictionary&lt;Value,Value&gt;
{
    {0, "message #0"},
    {1, "message #1"},
    {2, "message #2"}
};</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>You have 3 new message(s) in your inbox.</code>
					</blockquote>
					<p>All builtin functions available from the
					<code>BuiltinStore</code> class are described in paragraph
					"<a href="#builtin_functions">builtin functions</a>". For all
					following samples in this document we'll assume that builtin
					functions are available from rendered templates.</p>
				</div>

				<h3 id="conditional_statements">Conditional statements</h3>
				<div class="section">
					<p>You can write conditional statements by using the
					<code>if</code> command which uses a value as a predicate
					to check whether its body should be printed or not.
					Predicate is verified if value, once converted to a boolean
					type, is true. Any void value, empty string, zero number of
					empty map will be converted to false while any other value
					will be converted to true.</p>
					<p>Predicate must be followed by ":" (colon) character and
					body as a literal text (which can also include commands),
					then the end delimiter ("}"
					<a href="#delimiters_customization">unless you changed
					it</a>).</p>
					<blockquote class="code">
						<span>Template</span>
<code>{if 1:
    A condition on a numeric value is true if the value is non-zero.
}

{if 0:
    see?
}</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>A condition on a numeric value is true if the value is non-zero.</code>
					</blockquote>
					<p>The <code>if</code> command also supports optional
					<code>elif</code> (else if) and <code>else</code> blocks
					that behave like in any other programming language. Replace
					the "end command" special delimiter by "continue command"
					one ("|" <a href="#delimiters_customization">unless you
					changed it</a>) to end the <code>if</code> body then use
					either <code>else</code> or <code>elif</code> followed by a
					predicate, then a ":" (colon) character and another body as
					a literal text. Last block must be ended by the "end
					command" special delimiter:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{if test: Variable "test" is true! |else: Variable "test" is false! }

{if len(items) &gt; 2:
    There are more than two items in map ({len(items)}, actually).
}

{if x &lt; 0:
    X is negative.
|elif x &gt; 0:
    X is positive.
|else:
    X equals zero.
}</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>store["items"] = new Dictionary&lt;Value,Value&gt;
{
    {0, "item #0"},
    {1, "item #1"},
    {2, "item #2"}
};

store["test"] = 42;
store["x"] = -3;</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>Variable "test" is true!

There are more than two items in map (3, actually).

X is negative.</code>
					</blockquote>
				</div>

				<h3>Map values enumeration</h3>
				<div class="section">
					<p>Pairs contained within a map value can be enumerated
					with the <code>for</code> command, that will print its body
					for each key/value pair it found. An alternative syntax can
					be used if you only want to iterate on values and don't
					care about keys. The <code>for</code> command also supports
					an optional <code>empty</code> block printed when the map
					you tried to enumerate doesn't contain any key/value
					pair.</p>
					<p>Syntax of the <code>for</code> keyword and its optional
					<code>empty</code> block is similar to the one used by the
					<code>if</code> command:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{for index, text in messages:
    Message #{index + 1}: {text}
|empty:
    No messages to display.
}

Tags: {for tag in tags:{tag} }</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>store["messages"] = new Dictionary&lt;Value,Value&gt;
{
    {0, "Hi, this is a sample message!"},
    {1, "Hi, me again!"},
    {2, "Hi, guess what?"}
};

store["tags"] = new Value[]
{
    "action",
    "horror",
    "fantastic"
};</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>Message #1: Hi, this is a sample message!
Message #2: Hi, me again!
Message #3: Hi, guess what?

Tags: action horror fantastic</code>
					</blockquote>
				</div>

				<h3>Commenting your templates</h3>
				<div class="section">
					<p>You can use the <code>_</code> (underscore) command to
					add comments to your template. This command can be followed
					by any literal text and won't print any result when
					template is rendered.</p>
					<blockquote class="code">
						<span>Template</span>
<code>{_ This is a comment that will be ignored when rendering the template}
Hello, World!</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>Hello, World!</code>
					</blockquote>
				</div>

				<h3 id="variables_assignment">Variable assignments</h3>
				<div class="section">
					<p>You can assign variables while template is being
					rendered by using the <code>set</code> command. This
					command affects the same store you passed to document
					rendering method and either insert or update a value into
					it.</p>
					<p>Variable assignment allows you improve performance by
					storing evaluation results (such as function calls) that
					are going to be used several times, or code complex
					template mechanism by combining the <code>if</code>,
					<code>for</code> and <code>set</code> commands.</p>
					<blockquote class="code">
						<span>Template</span>
<code>{set nb_msgs to len(messages)}

{if nb_msgs &gt; 0:
    You have {nb_msgs} new message{if nb_msgs &gt; 1:s} in your mailbox!
|else:
    You have no new message.
}

{set nb_long to 0}

{for message in messages:
    {if len(message) &gt; 20:
        {set nb_long to nb_long + 1}
    }
}

{nb_long} message{if nb_long &gt; 1:s is|else: are} more than 20 characters long.</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>store["messages"] = new Dictionary&lt;Value,Value&gt;
{
    {0, "Hi, this is a sample message!"},
    {1, "Hi, me again!"},
    {2, "Hi, guess what?"}
};</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>You have 3 new messages in your mailbox!

1 message is more than 20 characters long.</code>
					</blockquote>
					<p>More advanced use of variable assignments are explained
					later in this document.</p>
				</div>

				<h3>Conditional loops</h3>
				<div class="section">
					<p>The <code>while</code> command evaluates its predicate
					argument and continues executing its body until predicate
					is false. Be sure to check for a condition that will
					become false after a finite number of iterations, or
					rendering of your template will never complete.</p>
					<blockquote class="code">
						<span>Template</span>
<code>{set password to ""}
{set nb to rand(8, 16)}
{set i to 0}

{while i &lt; nb:
    {set ascii to rand(62)}

    {if ascii &lt; 10:
        {set password to cat(password, char(ascii + ord("0")))}
    |elif ascii &lt; 36:
        {set password to cat(password, char(ascii + ord("A") - 10))}
    |else:
        {set password to cat(password, char(ascii + ord("a") - 36))}
    }

    {set i to i + 1}
}

Your random password is: {password}.</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>Your random password is: 2PIBnodftxz8jAX.</code>
					</blockquote>
					<p>When possible, prefer the use of the <code>for</code>
					command over <code>while</code>.</p>
				</div>
			</div>

			<h2>Configuration options</h2>
			<div class="section">
				<h3>Dynamic compiled documents</h3>
				<div class="section">
					<p>Code sample from the "<a href="#getting_started">getting
					started</a>" section used a <code>SimpleDocument</code>
					object to convert template into a renderable document. This
					class uses a simple tree evaluator to provide decent
					performance and light construction cost. In some cases you
					may want to benefit from better rendering performance at
					the cost of a heavier construction impact.</p>
					<p>This is where <code>DynamicDocument</code> may come in
					handy: this alternative document uses dynamic IL generation
					to compile your template into executable code directly:</p>
					<blockquote class="code">
						<span>C# code</span>
<code>document = <strong>new DynamicDocument(myTemplate)</strong>; // throws ParseException on error</code>
					</blockquote>
					<p>You should use <code>DynamicDocument</code> only if you
					render your documents way more often than you compile them,
					otherwise you would probably put too much pressure on
					.NET's garbage collector (bench and compare both variants
					to select the one which better suits your needs).<p>
					<p>Also note that performance gain increases with the
					number of commands you use in your templates ; almost
					plain-text templates won't render faster with a dynamic
					document.</p>
				</div>

				<h3>Using custom configuration</h3>
				<div class="section">
					<p>When creating a new Cottle document, you can pass it an
					optional <code>Cottle.ISetting</code> object which contains
					configuration parameters. If this parameter is missing then
					a default instance is used. You can use builtin
					<code>Cottle.Settings.CustomSetting</code> object to
					override any configuration parameter you want, or implement
					the interface yourself for more advanced uses:</p>
					<blockquote class="code">
						<span>C# code</span>
<code>void RenderAndPrintMyTemplate()
{
    IDocument     document;
    CustomSetting setting;
    IStore        store;

    setting = new CustomSetting();

    <strong>/* TODO: update setting properties */</strong>

    using (Stream stream = new FileStream("test.cottle", FileMode.Open))
    {
        using (StreamReader reader = new StreamReader(stream, Encoding.UTF8))
        {
            document = new SimpleDocument(reader, setting); // throws ParseException on error
        }
    }

    store = new BuiltinStore(); // this is where variables can be stored

    <strong>/* TODO: assign some values to store */</strong>

    Console.Write(document.Render(store));
}</code>
					</blockquote>
					<p>Configuration parameters can be updated where the first
					"<strong>TODO</strong>" comment is located. This code will
					be used for detailed usage of specific parameters in
					following sections.</p>
				</div>

				<h3>Raw text trimming</h3>
				<div class="section">
					<p>Cottle's default behavior for raw text is to render it
					without any modification. While this gives you a perfect
					character-level control of how a template is rendered, it
					may prevent you from writing clean indented code for target
					formats where white spaces are either ignored or collapsed,
					such as HTML.</p>
					<p>For that reason, you can change the way raw text is
					transformed by Cottle before it is rendered through the use
					of "trimmers". Some default trimmers are bundled with the
					library but you can write your own if needed. Available
					trimmers are:</p>
					<ul>
						<li>CollapseBlankCharacters: replace all sequences of
						white characters (spaces, line breaks, etc.) by a
						single space. This can be handy for targetting
						languages that ignore consecutive whitespaces such as
						HTML or XML.</li>
						<li>LeadingAndTrailingBlankCharacters: remove all
						leading and trailing blank characters from raw text
						blocks.</li>
						<li>FirstAndLastBlankLines: remove first and last empty
						lines from raw text blocks except for blocks that
						contain only blank characters.</li>
					</ul>
					<p>Here are some simple templates and their rendered
					results using different cleaners. Unlike other examples in
					this document, exact white spaces are preserved in
					results.</p>
					<p>CollapseBlankCharacters:</p>
					<blockquote class="code">
						<span>Template</span>
<code>&lt;ul&gt;
    {for s in ["First", "Second", "Third"]:
        &lt;li&gt;
            {s}
        &lt;/li&gt;
    }
&lt;/ul&gt;</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>setting.Trimmer = Trimmers.CollapseBlankCharacters;</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>&lt;ul&gt;  &lt;li&gt; First &lt;/li&gt;  &lt;li&gt; Second &lt;/li&gt;  &lt;li&gt; Third &lt;/li&gt;  &lt;/ul&gt;</code>
					</blockquote>
					<p>LeadingAndTrailingBlankCharacters:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{'white'} {'spaces '} around raw blocks are
going to be
{' collapsed'} .</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>setting.Trimmer = Trimmers.LeadingAndTrailingBlankCharacters;</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>whitespaces around raw blocks are
going to be collapsed.</code>
					</blockquote>
					<p>FirstAndLastBlankLines:</p>
					<blockquote class="code">
						<span>Template</span>
<code>This is a line of text with {'inline'} Cottle code.

{for s in ["normal", "exceptional", "elite"]:
    - Length of string "{s}" is {len(s)} character(s).

}</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>setting.Trimmer = Trimmers.FirstAndLastBlankLines;</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>This is a line of text with inline Cottle code.
    - Length of string "normal" is 6 character(s).
    - Length of string "exceptional" is 11 character(s).
    - Length of string "elite" is 5 character(s).</code>
					</blockquote>
					<p>If you want to write your own trimmer, assign a method
					taking a <code>string</code> as its only argument and
					returning the "trimmed" text. This method will be called on
					for each raw text block from input templates should return
					the text you want to appear when printed document is
					rendered.</p>
				</div>

				<h3 id="delimiters_customization">Delimiters customization</h3>
				<div class="section">
					<p>When using default configuration, Cottle uses {
					character to start a code block, | to continue it (before
					an <code>else</code> statement for example), and } to end
					it. These characters may not be a good choice if you want
					to write a template that makes extensive literal use of
					them, for example if you're writing a JavaScript template,
					because you would have to escape every {, } and | to avoid
					Cottle seeing them as block delimiters.</p>
					<p>To workaround this problem, you can change default block
					delimiters when creating a new document. New delimiters can
					be any string and won't be validated by Cottle, so you
					should avoid anything ambiguous otherwise the parser may
					not be able to understand your code. For example, choosing
					the ] character as a delimiter is a bad idea, as it will
					conflict with internal end-of-map delimiter.</p>
					<blockquote class="code">
						<span>Template</span>
<code>Block delimiters are now [[block_begin]], [[block_continue]] and [[block_end]].</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>setting.BlockBegin = "[[";
setting.BlockContinue = "||";
setting.BlockEnd = "]]";

store["block_begin"] = "double left bracket (" + setting.BlockBegin + ")";
store["block_continue"] = "double pipe (" + setting.BlockContinue + ")";
store["block_end"] = "double right bracket (" + setting.BlockEnd + ")";</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>Block delimiters are now double left bracket ([[), double pipe (||) and double right bracket (]]).</code>
					</blockquote>
				</div>

				<h3>Disable code optimizer</h3>
				<div class="section">
					<p>Cottle performs various optimizations on your code when
					converting a template into document to ensure faster
					rendering. You may want to disable these optimizations for
					some reasons, e.g. when debugging, or if you want to speed
					up document construction (but slow down rendering):</p>
					<blockquote class="code">
						<span>C# code</span>
						<code>setting.Optimize = false;</code>
					</blockquote>
					<p>Turning optimization off is not recommended however.</p>
				</div>
			</div>

			<h2>Advanced topics</h2>
			<div class="section">
				<h3>Debug value contents</h3>
				<div class="section">
					<p>When your template doesn't render as you would expect,
					the <code>dump</code> command can help you identify issues
					by showing value as an explicit human readable string.
					Undefined values, for example, won't print anything when
					passed through the <code>echo</code> command, but the
					<code>dump</code> command will show them as
					<code>&lt;void&gt;</code>.</p>
					<blockquote class="code">
						<span>Template</span>
<code>{dump "string"}
{dump 42}
{dump unknown(3)}
{dump [856, "hello", "x": 17]}</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>"string"
42
&lt;void&gt;
[0: 856, 1: "hello", "x": 17]</code>
					</blockquote>
				</div>

				<h3>Understanding value types</h3>
				<div class="section">
					<p>Every value has a type in Cottle, even if you usually
					don't have to worry about it. Functions that expect
					arguments of specific types will try to cast them silently
					or fallback to <code>void</code> values if they can't. In
					some cases you may have to force a cast yourself to get
					desired result, for example when accessing values from a
					map:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{set map to ["first", "second", "third"]}
{set key to "1"}

{dump map[key]}</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>&lt;void&gt;</code>
					</blockquote>
					<p>You could have expected this template to display
					"second", but Cottle actually searches for the map value
					associated to key "1" (as a string), not key 1 (as a
					number). These are two different values and storing two
					different values for keys "1" and 1 in a map is perfectly
					valid, hence no automatic cast can be performed for
					you.</p>
					<p>In this example, you can explicitely change the type of
					<code>key</code> to a number by using the
					<a href="#function_cast">cast</a> builtin function.</p>
				</div>

				<h3>Workaround immutability</h3>
				<div class="section">
					<p>Variables in Cottle are immutable, meaning it's not
					possible to replace portion of a string or assign some
					value to a map subscript. If you want to append, replace or
					erase a value in a map, you'll have to build a new one
					where you inject, filter out or replace desired value.
					Builtin functions
					"<a href="#function_cat">cat</a>",
					"<a href="#function_slice">slice</a>",
					"<a href="#function_union">union</a>",
					"<a href="#function_except">except</a>" can be used to
					easily achieve such operations:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{set my_string to "Modify me if you can"}
{set my_string to cat("I", slice(my_string, 16), ".")}
{dump my_string}

{set my_array to [4, 8, 50, 90, 23, 42]}
{set my_array to cat(slice(my_array, 0, 2), slice(my_array, 4))}
{set my_array to cat(slice(my_array, 0, 2), [15, 16], slice(my_array, 2))}
{dump my_array}

{set my_hash to ["delete_me": "TODO: delete this value", "let_me": "I shouldn't be touched"]}
{set my_hash to union(my_hash, ["append_me": "I'm here!"])}
{set my_hash to except(my_hash, ["delete_me": 0])}
{dump my_hash}</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>"I can."
[0: 4, 1: 8, 0: 15, 1: 16, 4: 23, 5: 42]
["let_me": "I shouldn't be touched", "append_me": "I'm here!"]</code>
					</blockquote>
				</div>

				<h3>Functions declaration</h3>
				<div class="section">
					<p>Cottle allows you to declare functions directly in your
					template code so you can factor code as you would do with
					any other programming language. To declare a function and
					assign it to a variable use the same <code>set</code> you
					used for regular values assignments with a slightly
					different syntax. Function arguments must be specified
					between parenthesis right after the variable name that
					should receive the function, and the <code>to</code>
					keyword must be followed by a ":" (semicolon) character
					then function body declaration.</p>
					<p>Functions can return a value that can be used in any
					expression or stored in a variable. To make a function halt
					and return a value, use the <code>return</code> command
					within its body:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{set factorial(n) to:
    {if n &gt; 1:
        {return n * factorial(n - 1)}
    |else:
        {return 1}
    }
}

Factorial 1 = {factorial(1)}
Factorial 3 = {factorial(3)}
Factorial 8 = {factorial(8)}

{set hanoi_rec(n, from, by, to) to:
    {set n to n - 1}

    {if n &gt; 0: {hanoi_rec(n, from, to, by)}}
Move one disk from {from} to {to}
    {if n &gt; 0: {hanoi_rec(n, by, from, to)}}
}

{set hanoi(n) to:
    {hanoi_rec(n, "A", "B", "C")}
}

{hanoi(3)}</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>Factorial 1 = 1
Factorial 3 = 6
Factorial 8 = 40320

Move one disk from A to C
Move one disk from A to B
Move one disk from C to B
Move one disk from A to C
Move one disk from B to A
Move one disk from B to C
Move one disk from A to C</code>
					</blockquote>
					<p>You can see in this example that returning a value and
					printing text are two very different things. Raw text
					within function body is printed each time the function is
					called, or more precisely each time its enclosing block is
					executed (that means it won't print if contained in an
					<code>if</code> command that fails to pass, for
					example).</p>
					<p>The value returned by the function won't be printed
					unless you explicitly require it by using the
					<code>echo</code> command (e.g. something like
					<code>{factorial(8)}</code>). If a function doesn't use any
					<code>return</code> command it returns an undefined value,
					that's why the call to <code>{hanoi(3)}</code> in the
					sample above does not print anything more than the raw text
					blocks it contains.</p>
				</div>

				<h3>Assigned variables scope</h3>
				<div class="section">
					<p>When writing complex templates using nested or recursive
					functions, you may have to take care of variable scopes to
					avoid potential issues. A scope is the local evaluation
					context of any function or command having a body. When
					assigning a value to a variable as described in paragraph
					"<a href="#variables_assignment">Variables assignment</a>",
					all variables belong to the same top-level scope. Consider
					this template:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{set depth(item) to:
    {set res to 0}

    {for child in item:
        {set res_child to depth(child) + 1}
        {set res to max(res, res_child)}
    }

    {return res}
}

{depth([["1.1", "1.2", ["1.3.1", "1.3.2"]], "2", "3", ["4.1", "4.2"]])}</code>
					</blockquote>
					<p>The <code>depth</code> function is expected to return
					the level of the deepest element in a value that contains
					nested maps. Of course it could be written in a much more
					efficient way without using non necessary temporary
					variables, but it would hide the problem we want to
					illustrate. If you try to execute this code you'll notice
					it returns <code>2</code> where <code>3</code> would have
					been expected.</p>
					<p>Here is the explanation: when using the <code>set</code>
					method to assign a value to variable <code>res</code>, it
					always uses the same <code>res</code> instance.
					The <code>depth</code> function recursively calls itself
					but overwrite the unique <code>res</code> variable each
					time it tries to store a value in it, and therefore fails
					to store the actual deepest level as it should.</p>
					<p>To solve this issue, the <code>res</code> variable needs
					to be local to function <code>depth</code> so that each
					invocation uses its own <code>res</code> instance. This can
					be achieved by using the <code>declare</code> command that
					creates a variable in current scope. Our previous example
					can then be fixed by declaring a new <code>res</code>
					variable inside body of function <code>depth</code>, so
					that every subsequent reference to <code>res</code>
					resolves to our local instance:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{set depth(item) to:
    <strong>{declare res}</strong>
    {set res to 0}

    {for child in item:
        {set res_child to depth(child) + 1}
        {set res to max(res, res_child)}
    }

    {return res}
}

{depth([["1.1", "1.2", ["1.3.1", "1.3.2"]], "2", "3", ["4.1", "4.2"]])}</code>
					</blockquote>
					<p>You could even optimize the first <code>set</code>
					command away by assigning a value to <code>res</code>
					during declaration ; the <code>declare</code> command
					allows you to assign functions or values to variables by
					using the same kind of syntax than the <code>set</code>
					command, the only difference being than "to" should be
					replaced by "as":</p>
					<blockquote class="code">
						<span>Template</span>
<code>{declare res as 0}</code>
					</blockquote>
					<p>The same command can also be used to declare
					functions:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{declare depth(item) as:
    ...
}</code>
					</blockquote>
					<p>Note that the <code>set</code> command can also be used
					without argument, and assigns variable a void value.</p>
				</div>

				<h3 id="custom_dotnet_methods">Custom .NET methods</h3>
				<div class="section">
					<p>If you need new features or improved performance, you
					can assign your own .NET methods to template variables.
					That's actually what Cottle does when you use a
					<code>BuiltinStore</code> object in your code: a set of
					internal .NET methods is assigned to your store, just have
					a look at source code to see how these methods work.</p>
					<p>To assign a method to a store, wrap it within a
					<code>NativeFunction</code> object which can then be stored
					in a <code>FunctionValue</code> (an implicit constructor is
					also available), then add it to your store as you would do
					for any value:</p>
					<blockquote class="code">
						<span>Template</span>
<code>Testing custom "repeat" function:

{repeat("a", 15)}
{repeat("oh", 7)}
{repeat("-", 10)}</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>// Implicit construction of Value from a NativeFunction instance
store["repeat"] = new NativeFunction((values, store, output) =>
{
	StringBuilder builder = new StringBuilder();
	int           i;

	for (i = 0; i &lt; values[1].AsNumber; ++i)
		builder.Append(values[0].AsString);

	return builder.ToString();
}, 2);</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>Testing custom "repeat" function:

aaaaaaaaaaaaaaa
ohohohohohohoh
----------</code>
					</blockquote>
					<p>Your custom .NET method can take up to three arguments
					but only the first one is mandatory:</p>
					<ul>
						<li>The <code>IList&lt;Value&gt;</code> of arguments
						passed to the function,</li>
						<li>The <code>IStore</code> containing all variables
						currently defined in the document,</li>
						<li>A <code>TextWriter</code> opened on document
						rendering output.</li>
					</ul>
					<p>Arguments are instances of the <code>Value</code> class,
					which can hold data of any type known by Cottle. You can
					access their <code>AsBoolean</code>,
					<code>AsFunction</code>, <code>AsNumber</code> and
					<code>AsString</code> properties to get data of desired
					type (automatic type conversion will be performed if
					needed). You can also use the <code>Type</code> property to
					know which data type a <code>Value</code> instance is
					actually holding. The <code>Fields</code> property contains
					all key/value pairs.</p>
					<p>In most cases you won't use store and output text
					writer, but may need them if you want to run a function
					evaluation within your code. The text writer instance can
					however be used if you want your function to print
					something.</p>
					<p>The <code>NativeFunction</code> constructors also accept
					2 more optional arguments used to indicate how many
					arguments are expected for your function. You can either
					ignore those arguments (and check yourself how many
					values your function received), specify an exact number of
					expected arguments, or specify min/max boundaries (-1 as a
					max boundary means "unlimited"). When specifying expected
					arguments count, Cottle will perform this check for you
					each time your function is invoked and ignore the call on
					error.</p>
					<p>Your custom function is expected to return a
					<code>Value</code> object. Remember that implicit
					constructors are available, so returning a compatible .NET
					native type is valid too.</p>
				</div>

				<h3>Lazy value evaluation</h3>
				<div class="section">
					<p>In some cases, you may want to inject to your template
					big and/or complex values that may or may not be needed at
					rendering, depending on other parameters. In such
					configurations, it may be better to avoid injecting the
					entire value in your store if there is chances it won't be
					used, and use lazy evaluation instead.</p>
					<p>Lazy evaluation allows you to inject a value with a
					"resolver" callback which will be called only the first
					time value is accessed, or not called at all if value is
					not used for rendering. Lazy values are just another
					specialized version of the <code>Value</code> object and
					are built from any resolver callback that returns a
					<code>Value</code> instance:</p>
					<blockquote class="code">
						<span>Template</span>
<code>{if is_admin:
    Administration log:
    {log}
}</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>store = new BuiltinStore();
store["is_admin"] = user.IsAdmin;
store["log"] = () => log.BuildComplexLogValue(); // implicit conversion to LazyValue

document.Render(store, Console.Out);</code>
					</blockquote>
					<p>In this example, method
					<code>log.BuildComplexLogValue</code> won't
					be called unless <code>is_admin</code> value is true.</p>
				</div>

				<h3>Inspect through reflection</h3>
				<div class="section">
					<p>Instead of converting complex object hierarchies to
					Cottle values, you can have the library do it for you by
					using .NET reflection. Keep in mind that reflection is
					significantly slower than creating Cottle values manually,
					but as it's a lazy mechanism it may be a good choice if you
					have complex objects and don't know in advance which fields
					might be used in your templates.</p>
					<p>To use reflection, create a new ReflectionValue from any
					.NET object instance, and push it to your store. Its fields
					and properties will be accessible like if it were a Cottle
					map:</p>
					<blockquote class="code">
						<span>Template</span>
<code>Your image has a size of {image.Width}x{image.Height} pixels.

{for key, value in image:
    {key} = {value}
}</code>
					</blockquote>
					<blockquote class="code">
						<span>C# code</span>
<code>store["image"] = new ReflectionValue(new Bitmap(50, 50));</code>
					</blockquote>
					<blockquote class="code">
						<span>Result</span>
<code>Your image has a size of 50x50 pixels.

nativeImage =
Tag =
PhysicalDimension =
Size =
Width = 50
Height = 50
HorizontalResolution = 96
VerticalResolution = 96
Flags = 2
RawFormat =
PixelFormat =
Palette =
FrameDimensionsList =
PropertyIdList =
PropertyItems =</code>
					</blockquote>
					<p>By default, a <code>ReflectionValue</code> will read all
					instance members, both public and private. If you want to
					change this behavior, specify your BindingFlags as a second
					parameter to <code>ReflectionValue</code> constructor.</p>
				</div>
			</div>

			<h2 id="builtin_functions">Builtin functions</h2>
			<div class="section">
				<h3>Numeric and mathematical</h3>
				<div class="section">
					<h4>abs(numeric)</h4>
					<div class="section">
						<p>Return the absolute value of given numeric value.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{abs(-3)}
{abs(5)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>3
5</code>
						</blockquote>
					</div>

					<h4>add(a, b)</h4>
					<div class="section">
						<p>Return the sum of two numeric values (equivalent to
						<code>+</code> operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{add(3, 7)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>10</code>
						</blockquote>
					</div>

					<h4>ceil(x)</h4>
					<div class="section">
						<p>Returns the smallest integer greater than or equal to
						decimal value <code>x</code>.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{ceil(2.7)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>3</code>
						</blockquote>
					</div>

					<h4>cos(x)</h4>
					<div class="section">
						<p>Get the cosine of angle <code>x</code> in radians.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{cos(-1.57)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>0.000796326710733263</code>
						</blockquote>
					</div>

					<h4>div(a, b)</h4>
					<div class="section">
						<p>Return the numeric value of <code>a</code> divided
						by the numeric value of <code>b</code> (equivalent to
						<code>/</code> operator). Result of a division by zero
						is a void value.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{div(5, 2)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>2.5</code>
						</blockquote>
					</div>

					<h4>floor(x)</h4>
					<div class="section">
						<p>Returns the largest integer less than or equal to
						decimal value <code>x</code>.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{floor(2.7)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>2</code>
						</blockquote>
					</div>

					<h4>max(a[, b[, c, ...]])</h4>
					<div class="section">
						<p>Return the highest numeric value among given ones.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{max(7, 5)}
{max(6, 8, 5, 7, 1, 2)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>7
8</code>
						</blockquote>
					</div>

					<h4>min(a[, b[, c, ...]])</h4>
					<div class="section">
						<p>Return the lowest numeric value among given ones.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{min(9, 3)}
{min(6, 8, 5, 7, 1, 2)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>3
1</code>
						</blockquote>
					</div>

					<h4>mod(a, b)</h4>
					<div class="section">
						<p>Return the value of the first numeric argument modulo
						the second one (equivalent to <code>%</code>
						operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{mod(7, 3)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>1</code>
						</blockquote>
					</div>

					<h4>mul(a, b)</h4>
					<div class="section">
						<p>Return the numeric value of <code>a</code> times
						<code>b</code> (equivalent to <code>*</code>
						operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{mul(3, 4)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>12</code>
						</blockquote>
					</div>

					<h4>pow(x, y)</h4>
					<div class="section">
						<p>Get specified number <code>x</code> raised to the power
						<code>y</code>.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{pow(2, 10)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>1024</code>
						</blockquote>
					</div>

					<h4>rand([a[, b]])</h4>
					<div class="section">
						<p>Get a pseudo-random numeric value between 0 and
						2.147.483.647 inclusive. If numeric <code>a</code> value
						is specified, return a pseudo-random numeric value
						between 0 and <code>a</code> exclusive. If both numeric
						values <code>a</code> and <code>b</code> are specified,
						return a pseudo-random numeric value between
						<code>a</code> inclusive and <code>b</code> exclusive.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{rand()}
{rand(1, 7)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>542180393
5</code>
						</blockquote>
					</div>

					<h4>round(x[, y])</h4>
					<div class="section">
						<p>Rounds a decimal value to a specified number of
						fractional digits <code>y</code>, or to the nearest
						integral value if <code>y</code> is not specified.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{round(1.57)}
{round(1.57, 1)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>2
1.6</code>
						</blockquote>
					</div>

					<h4>sin(x)</h4>
					<div class="section">
						<p>Get the sine of angle <code>x</code> in radians.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{sin(1.57)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>0.999999682931835</code>
						</blockquote>
					</div>

					<h4>sub(a, b)</h4>
					<div class="section">
						<p>Return the numeric value of a minus b (equivalent to
						<code>-</code> operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{sub(3, 5)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>-2</code>
						</blockquote>
					</div>
				</div>

				<h3>String and map processing</h3>
				<div class="section">
					<h4 id="function_cat">cat(a, b, ...)</h4>
					<div class="section">
						<p>Concatenate all input values into a single one. This
						function works on both strings and maps (keys are not
						preserved when used with maps).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{cat("Hello, ", "World!")}
{for v in cat([1, 2], [3]): {v}}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>Hello, World!
1 2 3</code>
						</blockquote>
					</div>

					<h4>char(int)</h4>
					<div class="section">
						<p>Get a 1-character string from its unicode numeric
						value. See
						<a href="http://en.wikipedia.org/wiki/Unicode">Unicode on
						Wikipedia</a> for details.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{char(97)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>a</code>
						</blockquote>
					</div>

					<h4>find(value, token[, start])</h4>
					<div class="section">
						<p>Find the 0-based index of given token in a map, or
						sub-string in a string. Search starts at index 0 unless
						<code>start</code> argument is specified.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{find([89, 3, 572, 35, 7], 35)}
{find("hello, world!", "o", 5)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>3
8</code>
						</blockquote>
					</div>

					<h4>format(value, format[, culture])</h4>
					<div class="section">
						<p>Convert any <code>value</code> to a string using given
						formatting from <code>format</code> string expression.
						Format should use syntax "expr" or "t:expr" where "t"
						indicates the type of the formatter to use, and "expr" is
						the .NET format specifier. Available formatter types
						are:</p>
						<ul>
							<li>a: automatic (default, used if "t" is omitted)</li>
							<li>b: System.Boolean</li>
							<li>d or du: System.DateTime (UTC)</li>
							<li>dl: System.DateTime (local)</li>
							<li>i: System.Int64</li>
							<li>n: System.Decimal</li>
							<li>s: System.String</li>
						</ul>
						<blockquote class="code">
							<span>Template</span>
<code>{format(1339936496, "d:yyyy-MM-dd HH:mm:ss")}
{format(0.165, "n:p2", "fr-FR")}
{format(1, "b:n2")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>2012-06-17 12:34:56
16,50 %
True</code>
						</blockquote>
						<p>Formatters use current culture, unless a culture name is
						specified in the <code>culture</code> argument. See
						<a href="http://msdn.microsoft.com/fr-fr/goglobal/bb896001.aspx">National Language Support API on MSDN</a>
						for a list of valid culture names.</p>
					</div>

					<h4>lcase(string)</h4>
					<div class="section">
						<p>Return a lowercase conversion of given string value.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{lcase("Mixed Case String"}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>mixed case string</code>
						</blockquote>
					</div>

					<h4>len(a)</h4>
					<div class="section">
						<p>Return the length or given value, that is number pairs
						if value was a map, or number of characters if value
						was a string.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{len("Hello!")}
{len([17, 22, 391, 44])}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>6
4</code>
						</blockquote>
					</div>

					<h4>match(string, pattern)</h4>
					<div class="section">
						<p>Match <code>string</code> against given regular
						expression pattern. If match is successful, a map
						containing each captured group is returned, otherwise
						result is a void value. See
						<a href="http://msdn.microsoft.com/en-us/library/hs600312(v=vs.71).aspx">.NET
						Framework Regular Expressions</a> for more information.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{dump match("abc123", "^[a-z]+([0-9]+)$")}
{dump match("xyz", "^[a-z]+([0-9]+)$")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>[0: "abc123", 1: "123"]
&lt;void&gt;</code>
						</blockquote>
					</div>

					<h4>ord(char)</h4>
					<div class="section">
						<p>Get the numeric unicode value of the first character
						of given string. See
						<a href="http://en.wikipedia.org/wiki/Unicode">Unicode on
						Wikipedia</a> for details.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{ord("a")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>97</code>
						</blockquote>
					</div>

					<h4 id="function_slice">slice(value, index[, count])</h4>
					<div class="section">
						<p>Extact sub-string from a string or elements from a
						map (keys are not preserved when used with maps).
						<code>count</code> items or characters are extracted
						from given 0-based numeric <code>index</code>. If no
						<code>count</code> argument is specified, all elements
						starting from given <code>index</code> are
						extracted.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{for v in slice([68, 657, 54, 3, 12, 9], 3, 2): {v}}
{slice("abchello", 4)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>3 12
hello</code>
						</blockquote>
					</div>

					<h4>split(input, separator)</h4>
					<div class="section">
						<p>Split string <code>input</code> according to given
						string separator <code>separator</code>. Result is an
						map where pair values contain split sub-strings.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{dump split("2011/01/01", "/")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>[0: "2011", 1: "01", 2: "01"]</code>
						</blockquote>
					</div>

					<h4>token(string, search, index[, replace])</h4>
					<div class="section">
						<p>Either return the n-th section of a string delimited by
						separator substring <code>search</code> if no
						<code>replace</code> argument is provided, or replace this
						section by <code>replace</code> else. This function can be
						used as a faster alteranative to combined split/slice/join
						calls in some cases.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{token("First.Second.Third", ".", 1)}
{token("A//B//C//D", "//", 2)}
{token("XX-??-ZZ", "-", 1, "YY")}
{token("1;2;3", ";", 3, "4")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>Second
C
XX-YY-ZZ
1;2;3;4</code>
						</blockquote>
					</div>

					<h4>ucase(string)</h4>
					<div class="section">
						<p>Return an uppercase conversion of given string
						value.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{ucase("Mixed Case String"}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>MIXED CASE STRING</code>
						</blockquote>
					</div>					
				</div>

				<h3>Comparison and boolean tests</h3>
				<div class="section">
					<h4>and(a, b, ...)</h4>
					<div class="section">
						<p>Perform logical "and" between given boolean values, i.e.
						return "true" if all arguments are true (equivalent to
						<code>&amp;&amp;</code> operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{and(2 &lt; 3, 5 &gt; 1)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>true</code>
						</blockquote>
					</div>

					<h4 id="function_cmp">cmp(a, b)</h4>
					<div class="section">
						<p>Compare <code>a</code> against <code>b</code>, and
						return -1 if <code>a</code> is lower than <code>b</code>,
						0 if they're equal, or 1 else. When used on numeric
						values, the <code>cmp</code> function uses numerical order.
						When used on strings, it uses alphabetical order. When
						used on maps, it first compare their lengths then compare
						their values if lengths are equal. Two values of different
						types are always different.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{cmp("abc", "bcd")}
{cmp(9, 6)}
{cmp([2, 4], [2, 4])}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>-1
1
0</code>
						</blockquote>
					</div>

					<h4>default(test[, fallback])</h4>
					<div class="section">
						<p>Return <code>test</code> if it
						<a href="#conditional_statements">evaluates to true</a>, or
						<code>fallback</code> otherwise (or a void value if
						<code>fallback</code> is missing).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{set x to 3}
{dump default(x, "invisible")}
{dump default(y, "visible")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>3
"visible"</code>
						</blockquote>
					</div>

					<h4>eq(a, b, ...)</h4>
					<div class="section">
						<p>Return true if all arguments are equal, or false
						otherwise (equivalent to <code>=</code> operator). See
						<a href="#function_cmp">cmp</a> common function for
						more information about comparisons.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{eq(7, 7)}
{eq(1, 4)}
{eq("test", "test")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>true
false
true</code>
						</blockquote>
					</div>

					<h4>ge(a, b)</h4>
					<div class="section">
						<p>Return true if the numeric value of <code>a</code> is
						greater than or equal to the numeric value of
						<code>b</code>, false otherwise (equivalent to
						<code>&gt;=</code> operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{ge(7, 3)}
{ge(2, 2)}
{ge("abc", "abx")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>true
true
false</code>
						</blockquote>
					</div>

					<h4>gt(a, b)</h4>
					<div class="section">
						<p>Return true if the numeric value of <code>a</code> is
						greater than the numeric value of <code>b</code>, false
						otherwise (equivalent to <code>&gt;</code>
						operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{gt(7, 3)}
{gt(2, 2)}
{gt("abc", "abx")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>true
false
false</code>
						</blockquote>
					</div>

					<h4>has(map, key)</h4>
					<div class="section">
						<p>Return true if given map has a value associated to
						given key, or false otherwise.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{has(["name": "Paul", "age": 37, "sex": "M"], "age")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>true</code>
						</blockquote>
					</div>

					<h4>le(a, b)</h4>
					<div class="section">
						<p>Return true if the numeric value of <code>a</code> is
						lower than or equal to the numeric value of <code>b</code>,
						false otherwise (equivalent to <code>&lt;=</code>
						operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{le(3, 7)}
{le(2, 2)}
{le("abc", "abx")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>true
true
true</code>
						</blockquote>
					</div>

					<h4>lt(a, b)</h4>
					<div class="section">
						<p>Return true if the numeric value of <code>a</code> is
						lower than the numeric value of <code>b</code>, false
						otherwise (equivalent to <code>&lt;</code>
						operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{lt(3, 7)}
{lt(2, 2)}
{lt("abc", "abx")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>true
false
true</code>
						</blockquote>
					</div>

					<h4>ne(a, b, ...)</h4>
					<div class="section">
						<p>Return true if all arguments are not equal, or false
						otherwise (equivalent to <code>!=</code> operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{ne(7, 7)}
{ne(1, 4)}
{ne("test", "test")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>false
true
false</code>
						</blockquote>
					</div>

					<h4>not(a)</h4>
					<div class="section">
						<p>Perform logical "not" on given boolean value, i.e
						return true if value was false or false if it was true
						(equivalent to <code>!</code> operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{not(1 = 2)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>true</code>
						</blockquote>
					</div>

					<h4>or(a, b, ...)</h4>
					<div class="section">
						<p>Perform logical "or" between given boolean values,
						i.e. return "true" if at least one argument is true
						(equivalent to <code>||</code> operator).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{or(2 = 3, 5 &gt; 1)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>true</code>
						</blockquote>
					</div>

					<h4>when(test[, true[, false]])</h4>
					<div class="section">
						<p>Return <code>true</code> if <code>test</code>
						<a href="#conditional_statements">evaluates to true</a>, or
						<code>false</code> otherwise (or a void value if
						<code>false</code> is missing).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{set x to 3}
{set y to 0}
{dump when(x, "x is true", "x is false")}
{dump when(y, "y is true", "y is false")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>"x is true"
"y is false"</code>
						</blockquote>
					</div>

					<h4>xor(a, b, ...)</h4>
					<div class="section">
						<p>Perform logical "xor" between given boolean values, i.e.
						return "true" if exactly one argument is true and all the
						others are false.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{xor(2 &lt; 3, 1 = 2)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>true</code>
						</blockquote>
					</div>
				</div>

				<h3>Functional programming</h3>
				<div class="section">
					<h4>cross(map1, map2, ...)</h4>
					<div class="section">
						<p>Return a map containing all pairs from
						<code>map1</code> having a key that also exists in
						<code>map2</code> and all following maps. Output pair
						values will always be taken from <code>map1</code>.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{dump cross([1: "a", 2: "b", 3: "c"], [1: "x", 3: "y"])}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>[1: "a", 3: "c"]</code>
						</blockquote>
					</div>

					<h4 id="function_except">except(map1, map2, ...)</h4>
					<div class="section">
						<p>Return a map containing all pairs from <code>map1</code>
						having a key that does not exist in <code>map2</code> and
						any of following maps. This function can also be used to
						remove a single pair from a map (if you are sure that it's
						key is not used by any other pair, otherwise all pairs
						using that key would be removed also).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{dump except([1: "a", 2: "b", 3: "c"], [2: "x", 4: "y"])}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>[1: "a", 3: "c"]</code>
						</blockquote>
					</div>

					<h4>filter(map, predicate[, a, b, ...])</h4>
					<div class="section">
						<p>Return a map containing all pairs having a value that
						satisfies given predicate. Function <code>predicate</code>
						is invoked for each value from <code>map</code> with this
						value as its first argument, and pair is added to output
						map if predicate result
						<a href="#conditional_statements">evaluates to true</a>.</p>
						<p>Optional arguments can be specified when calling
						<code>filter</code> and will be passed to each invocation
						of <code>predicate</code> as second, third, forth argument
						and so on.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{declare multiple_of(x, y) as: {return x % y = 0}}
{for v in filter([1, 6, 7, 4, 9, 5, 0], multiple_of, 3): {v}}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>6 9 0</code>
						</blockquote>
					</div>

					<h4>flip(map)</h4>
					<div class="section">
						<p>Return a map were pairs are created by swapping each
						key and value pair from input map. Using resulting map
						with the <code>for</code> command will still iterate
						through each pair even if there was duplicates, but only
						the last occurrence of each duplicate can be accessed
						using map subscript operator ([]).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{dump flip([1: "hello,", 2: "world!"])}
{dump flip(["a": 0, "b": 0])}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>["hello,": 1, "world!": 2]
[0: "a", 0: "b"]</code>
						</blockquote>
					</div>

					<h4>join(map[, string])</h4>
					<div class="section">
						<p>Concatenate all values from given map pairs, using
						given string as a separator (or empty string if no
						separator is provided).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{join(["2011", "01", "01"], "/")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>2011/01/01</code>
						</blockquote>
					</div>

					<h4>map(source, modifier[, a, b, ...])</h4>
					<div class="section">
						<p>Return a map where values are built by applying given
						modifier to map values, while preserving keys. Function
						<code>modifier</code> is invoked for each value in
						<code>source</code> with this value as its first
						argument.</p>
						<p>Optional arguments can be specified when calling
						<code>map</code> and will be passed to each invocation of
						<code>modifier</code> as second, third, forth argument and
						so on.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{declare square(x) as: {return x * x}}
{for v in map([1, 2, 3, 4], square): {v}}

{dump map(["a": 1, "b": 7, "c": 4, "d": 5, "e": 3, "f": 2, "g": 6], lt, 4)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>1 4 9 16
["a": 1, "b": 0, "c": 0, "d": 0, "e": 1, "f": 1, "g": 0]</code>
						</blockquote>
					</div>

					<h4>range([start, ]stop[, step])</h4>
					<div class="section">
						<p>Generate a map where value of the <em>i</em>-th pair
						is <em>start + step * i</em> and last value is lower (or
						higher if <code>step</code> is a negative integer) than
						<code>stop</code>. Default base index is 0 if the
						<code>start</code> argument is omitted, and default value
						for <code>step</code> is 1 if <code>start</code> &lt;
						<code>stop</code> or -1 otherwise.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{for v in range(5): {v}}
{for v in range(2, 20, 3): {v}}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>0 1 2 3 4
2 5 8 11 14 17</code>
						</blockquote>
					</div>

					<h4>sort(map[, callback])</h4>
					<div class="section">
						<p>Return a sorted copy of given map. First argument is
						the input map, and will be sorted using natural order
						(numerical or alphabetical, depending on value types) by
						default. You can specify a second argument as
						comparison delegate, that should accept two arguments and
						return -1 if the first should be placed "before" the
						second, 0 if they are equal, or 1 otherwise.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{set shuffled to ["in", "order", "elements" "natural"]}

{for item in sort(shuffled):
    {item}
}

{declare by_length(a, b) as:
    {return cmp(len(b), len(a))}
}

{set shuffled to ["by their", "are sorted", "length", "these strings"]}

{for item in sort(shuffled, by_length):
    {item}
}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>elements
in
natural
order

these strings
are sorted
by their
length</code>
						</blockquote>
					</div>

					<h4 id="function_union">union(map1, map2, ...)</h4>
					<div class="section">
						<p>Return a map containing all pairs from input maps,
						but without duplicating any key. If a key exists more than
						once in all input maps, the last one will overwrite any
						previous pair using it.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{dump union([1: "a", 2: "b"], [2: "x", 3: "c"], [4: "d"])}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>[1: "a", 2: "x", 3: "c", 4: "d"]</code>
						</blockquote>
					</div>

					<h4>zip(a, b)</h4>
					<div class="section">
						<p>Combine given maps to create a new one. The n-th pair
						in result map will use the n-th value from first map as
						its key and the n-th value of second map as its value. If
						the two maps don't have the same length, exceeding
						elements from the longest map are ignored.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{set a to ["key1", "key2", "key3"]}
{set b to ["value1", "value2", "value3"]}
{dump zip(a, b)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>["key1": "value1", "key2": "value2", "key3": "value3"]</code>
						</blockquote>
					</div>
				</div>

				<h3>Type and indirection</h3>
				<div class="section">
					<h4>call(func, map)</h4>
					<div class="section">
						<p>Call function <code>func</code> with values from given
						map as arguments (keys are not used).</p>
						<blockquote class="code">
							<span>Template</span>
<code>{call(cat, ["Hello", ", ", "World", "!"])}
{call(max, [3, 8, 2, 7])}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>Hello, World!
8</code>
						</blockquote>
					</div>

					<h4 id="function_cast">cast(value, type)</h4>
					<div class="section">
						<p>Get value converted to requested scalar type. Type must
						be a string value specifying desired type:</p>
						<ul>
							<li>"b" or "boolean": convert to boolean value</li>
							<li>"n" or "number": convert to numeric value</li>
							<li>"s" or "string": convert to string value</li>
						</ul>
						<blockquote class="code">
							<span>Template</span>
<code>{dump cast("2", "n") = 2}
{dump ["value for key 0"][cast("0", "n")]}
{dump cast("some string", "b")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>&lt;true&gt;
"value for key 0"
&lt;true&gt;</code>
						</blockquote>
					</div>

					<h4>defined(value)</h4>
					<div class="section">
						<p>Check whether value is defined or not. Note this is
						different than checking whether a value
						<a href="#conditional_statements">evaluates to true</a>
						or not: integer <code>0</code> is equivalent to false
						when used as a boolean expression, yet is defined. This
						function is mostly useful for testing if a variable has
						been assigned a value.</p>
						<blockquote class="code">
							<span>Template</span>
<code>{dump defined(undefined)}
{set a to 0}
{dump defined(a)}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>&lt;false&gt;
&lt;true&gt;</code>
						</blockquote>
					</div>

					<h4>type(value)</h4>
					<div class="section">
						<p>Retrieve type of given value as a string. Possible
						return values are "boolean", "function", "map",
						"number", "string" or "void".</p>
						<blockquote class="code">
							<span>Template</span>
<code>{dump type(15)}
{dump type("test")}</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>"number"
"string"</code>
						</blockquote>
					</div>
				</div>

				<h3>Obsolete functions</h3>
				<div class="section">
					<h4>include(path[, map[, map, ...]])</h4>
					<div class="section">
						<p>This function is obsolete as it is too specific and
						has insufficient customization support, and therefore
						is not available by default in
						<code>BuiltinStore</code> objects. You should consider
						reimplementing your own "include" function if you need
						a similar feature.</p>
						<p>Parse document from a template file and render it with
						variables extracted from given maps. Keys from input
						maps will be used as variable names associated to their
						respective values. For this example, we'll assume that a
						file named "article.cottle" is available in current
						directory and contains this template code:</p>
						<blockquote class="code">
							<blockquote><span>Template
							"article.cottle":</span></blockquote>
<code>&lt;div class="box"&gt;
    &lt;div class="title"&gt;{a.title}&lt;/div&gt;
    &lt;div class="text"&gt;{a.text}&lt;/div&gt;
&lt;/div&gt;</code>
						</blockquote>
						<p>Now, we want to include and render this template file in
						our global rendering:</p>
						<blockquote class="code">
							<span>Template</span>
<code>{for article in articles:
    {include("article.cottle", ["a": article])}
}</code>
						</blockquote>
						<blockquote class="code">
							<span>C# code</span>
<code>store["articles"] = new Value[]
{
    new Dictionary&lt;Value, Value&gt;
    {
        {"title", "First article"},
        {"text", "Lorem ipsum dolor sit amet, consectetur adipiscing elit."}
    },
    new Dictionary&lt;Value, Value&gt;
    {
        {"title", "Second article"},
        {"text", "Cras vitae erat dui, commodo gravida purus."}
    }
};</code>
						</blockquote>
						<blockquote class="code">
							<span>Result</span>
<code>&lt;div class="box"&gt;
    &lt;div class="title"&gt;First article&lt;/div&gt;
    &lt;div class="text"&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit.&lt;/div&gt;
&lt;/div&gt;
&lt;div class="box"&gt;
    &lt;div class="title"&gt;Second article&lt;/div&gt;
    &lt;div class="text"&gt;Cras vitae erat dui, commodo gravida purus.&lt;/div&gt;
&lt;/div&gt;</code>
						</blockquote>
						<p>By using <code>return</code> keyword in your included
						template, you can pass a value to the calling template (it
						will be available as the result of the call to function
						<code>include</code>).</p>
						<p>For performance reasons, included templates are stored
						in an internal cache which keeps parsed versions of the
						last 256 included documents. If you want to change cache
						size, use the <code>CommonFunctions.IncludeCacheSize</code>
						property. You can also disable the cache by setting the
						<code>CommonFunctions.IncludeCacheEnabled</code> to
						<code>false</code> ; be sure to set it back to
						<code>true</code> before deploying your code to a
						production environment.</p>
					</div>
				</div>
			</div>

			<h2>Reference</h2>
			<div class="section">
				<h3>Change log</h3>
				<div class="section">
					<p>Cottle version numbers use format A.B.C.D where each
					digit get incremented for different reasons:</p>
					<ul>
						<li>A changes when code base is entirely rewritten from
						scratch with no compatibility with previous version ;</li>
						<li>B changes when backwards incompatible changes are
						introduced to the API ;</li>
						<li>C changes when significant new features are added
						to the API while preserving backward compatibility ;</li>
						<li>D changes when a bugfix, patch or any other minor
						change is released.</li>
					</ul>
					<p>Here is a summary of backward-incompatible changes
					introduced in previous versions:</p>
					<ul>
						<li>1.2.0.0 =&gt; 1.3.0.0:
							<ul>
								<li>Removed deprecated code (flagged as
								"obsolete" in previous versions).</li>
							</ul>
						</li>
						<li>1.1.3.0 =&gt; 1.2.0.0:
							<ul>
								<li><code>IScope</code> replaced by similar
								<code>IStore</code> interface (they mostly
								differ by the return type of their "Set" method
								which made this impossible to change without
								breaking the API).</li>
								<li>Callback argument of constructors for
								<code>NativeFunction</code> are not compatible
								with <code>IScope</code> to avoid ambiguous
								statements.</li>
							</ul>
						</li>
						<li>1.0.1.0 =&gt; 1.1.0.0:
							<ul>
								<li><code>LexerConfig</code> must be replaced
								by <code>CustomSetting</code> object to change
								configuration.</li>
								<li><code>FieldMap</code> has been replaced by
								multiple implementations of the new
								<code>IMap</code> interface.</li>
								<li>Two values with different types are always
								different, even if casts could have made them
								equal (i.e. removed automatic casts when
								comparing values).</li>
								<li>Common functions <code>cross</code> and
								<code>except</code> now preserve duplicated
								keys.</li>
							</ul>
						</li>
					</ul>
				</div>

				<h3>Greetings</h3>
				<div class="section">
					<ul>
						<li>Huge thanks to
						<a href="http://www.yaronet.com/blogs/blog.php?id=456">Zerosquare</a>
						for the lovely project icon!</li>
					</ul>
				</div>

				<h3>Contact</h3>
				<div class="section">
					<p>Contact me by e-mail: cottle [at] mirari [dot] fr</p>
					<p><a href="http://remi.caput.fr/">Remi Caput</a>, 2012</p>
				</div>
			</div>
		</div>

		<script type="text/javascript">
<!--
(function (target, source, level, limit)
{
	var anchors;
	var child;
	var cursor;
	var	element;
	var items;
	var	link;
	var	next;
	var number;
	var parent;
	var stack;

	// Generate bootstrap-like aside menu from headers
	anchors = [];
	stack =
	[{
		elements	: source.childNodes,
		index		: 0,
		order		: 0
	}];

	while (stack.length > 0)
	{
		cursor = stack[stack.length - 1];

		if (cursor.index < cursor.elements.length)
		{
			element = cursor.elements[cursor.index++];

			if (element.tagName !== undefined && element.tagName[0] == 'H')
			{
				next = parseInt (element.tagName.substr (1));

				if (isNaN (next) || next > limit)
					continue;

				++cursor.order;

				for (; level > next; --level)
					target = target.parentNode.parentNode;

				number = '';

				for (var i = stack.length; i-- > 0; )
					number = stack[i].order + '.' + number;

				if (!element.id)
					element.id = 'toc-' + number.substr (0, number.length - 1);

				link = document.createElement ('a');
				link.innerHTML = element.innerHTML;
				link.href = '#' + element.id;

				child = document.createElement ('li');
				child.appendChild (link);

				element.innerHTML = number + ' ' + element.innerHTML;

				anchors.push
				({
					element:	element,
					level:		next,
					target:		child
				});

				for (; level < next; ++level)
				{
					items = target.getElementsByTagName ('li');

					if (items.length > 0)
						parent = items[items.length - 1];
					else
					{
						parent = document.createElement ('li');
						target.appendChild (parent);
					}

					target = document.createElement ('ul');
					parent.appendChild (target);
				}

				target.appendChild (child);
			}

			if (element.childNodes !== undefined && element.childNodes.length > 0)
			{
				stack.push
				({
					elements	: element.childNodes,
					index		: 0,
					order		: 0
				});
			}
		}
		else
			stack.pop ();
	}

	// Highlight current menu section when scrolling
	document.addEventListener ('scroll', function ()
	{
		var element;
		var index;
		var level;
		var top;

		index = 0;
		top = document.documentElement.scrollTop || document.body.scrollTop;

		for (; index < anchors.length; ++index)
		{
			element = anchors[index].element;

			if (element.offsetTop - element.offsetHeight > top)
			{
				if (index > 0)
				{
					level = anchors[index - 1].level + 1;

					for (var i = index - 1; i >= 0; --i)
					{
						if (anchors[i].level < level)
						{
							anchors[i].target.className = 'active';

							level = anchors[i].level;
						}
					}
				}

				break;
			}

			anchors[index].target.className = '';
		}

		for (; index < anchors.length; ++index)
			anchors[index].target.className = '';
	});
}) (document.getElementById ('toc-to'), document.getElementById ('toc-from'), 2, 3);

(function (target)
{
	if (target !== undefined)
		target.className = 'toc';
}) (document.getElementsByTagName ('body')[0]);
-->
		</script>
	</body>
</html>
